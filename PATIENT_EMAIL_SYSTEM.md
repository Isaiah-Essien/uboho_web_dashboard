# Patient Welcome Email System Documentation

## Overview

The Uboho Dashboard automatically sends welcome emails to patients when they are added to the hospital system. This provides a professional onboarding experience and gives patients their important account information.

## How It Works

### 1. Email Triggers

Welcome emails are automatically sent when:

- A new patient is added through the "Add Patient" form (`/patients/add`)
- The patient data is successfully saved to the hospital's database
- The email is sent asynchronously after patient creation

### 2. Email Content

The welcome email includes:

- **Patient Name**: Personalized greeting with the patient's full name
- **Hospital Name**: The name of the hospital that invited them
- **Patient ID**: Their unique patient identifier for future reference
- **Mobile App Link**: A dummy link to download the Uboho mobile app
- **Support Contact**: The patient's email for support purposes

### 3. Template Variables Used

The EmailJS template (`template_p0mxy8u`) uses these variables:

- `{{patient_name}}` - Patient's full name
- `{{hospital_name}}` - Hospital name from the system
- `{{patient_id}}` - Unique patient ID generated by the system
- `{{mobile_app_link}}` - Mobile app download link (currently dummy)
- `{{email}}` - Patient's email address

## Current Template Content

```
Welcome to the Uboho family, {{patient_name}}! We're excited to have you on board.

You've been invited by your hospital, {{hospital_name}}, and your account has been successfully created.

Your patient ID is {{patient_id}}.

You're now ready to explore all the great services we offer.

 Open Uboho

If you have any questions or need help getting started, our support team is just an email away at {{email}}. We're here to assist you every step of the way!

Best regards,
The Uboho Team
```

## Technical Implementation

### Files Involved

1. **`src/utils/emailService.js`** - Contains the `sendPatientWelcomeEmail` function
2. **`src/contexts/HospitalContext.jsx`** - Calls the email function after patient creation
3. **`src/pages/AddPatient.jsx`** - Patient creation form that triggers the process

### Email Service Configuration

```javascript
const EMAILJS_SERVICE_ID = "service_2nxh02m";
const EMAILJS_PATIENT_WELCOME_TEMPLATE_ID = "template_p0mxy8u";
const EMAILJS_PUBLIC_KEY = "ars7eBQgj4hgM2R5j";
```

### Function Flow

1. User fills out the "Add Patient" form
2. `AddPatient.jsx` calls `addPatient()` from HospitalContext
3. `HospitalContext.addPatient()` saves patient to database
4. After successful save, `sendPatientWelcomeEmail()` is called
5. EmailJS sends the templated email to the patient
6. Success/error is logged (email failure doesn't affect patient creation)

## Error Handling

- Email sending is non-blocking - patient creation succeeds even if email fails
- Detailed error logging helps troubleshoot EmailJS issues
- Common error codes (401, 400, 422) have specific error messages

## Testing

To test the email system:

1. Navigate to `/patients/add`
2. Fill out the patient form with a valid email address
3. Submit the form
4. Check the browser console for email sending logs
5. Check the patient's email inbox for the welcome message

## Future Enhancements

- Replace dummy mobile app link with actual app store links
- Add email delivery tracking
- Allow hospital admins to customize the welcome message
- Add email templates for different patient types
- Implement email verification for patient accounts

## Troubleshooting

### Email Not Sending

1. Check EmailJS service configuration
2. Verify template ID matches: `template_p0mxy8u`
3. Check browser console for detailed error messages
4. Ensure patient has a valid email address

### Template Variable Issues

Make sure the EmailJS template uses exactly these variable names:

- `{{patient_name}}`
- `{{hospital_name}}`
- `{{patient_id}}`
- `{{mobile_app_link}}`
- `{{email}}`

### Common Error Codes

- **401**: Authentication error - check service ID and public key
- **400**: Bad request - check template configuration
- **422**: Template error - check variable names match exactly
